# =============================================================================
# КОНФИГУРАЦИЯ PROMETHEUS ДЛЯ СБОРА МЕТРИК ORDERHUB
# =============================================================================
# Prometheus работает по pull-модели: сам заходит на приложение и забирает метрики
# Этот файл монтируется в контейнер prometheus через volumes в docker-compose
# =============================================================================

# -----------------------------------------------------------------------------
# ГЛОБАЛЬНЫЕ НАСТРОЙКИ (применяются ко всем job, если не переопределены)
# -----------------------------------------------------------------------------
global:
  # Как часто Prometheus опрашивает приложения (scrape = "соскребать" метрики)
  # 5s — для демо/разработки (часто, чтобы видеть изменения в реальном времени)
  # В production обычно 15-30s, чтобы не создавать лишнюю нагрузку
  scrape_interval: 5s
  
  # Как часто пересчитываются правила (recording rules и alerts)
  # Не влияет на сбор метрик, только на внутренние вычисления Prometheus
  evaluation_interval: 15s

# -----------------------------------------------------------------------------
# КОНФИГУРАЦИЯ СБОРА МЕТРИК (список целей для опроса)
# -----------------------------------------------------------------------------
scrape_configs:
  # Одна задача (job) — одно логическое приложение/сервис
  - job_name: 'orderhub-app'
    
    # Путь, по которому Prometheus будет забирать метрики
    # Spring Boot Actuator отдаёт метрики в формате Prometheus по этому адресу
    metrics_path: '/actuator/prometheus'
    
    # -------------------------------------------------------------------------
    # Статические цели (в отличие от service discovery в Kubernetes)
    # -------------------------------------------------------------------------
    static_configs:
      # Список таргетов (инстансов приложения) для этого job
      - targets: ['orderhub-app:8081']
        # Метки (labels), которые будут добавлены ко ВСЕМ метрикам из этого job
        # Это позволяет фильтровать метрики в PromQL по application/environment
        labels:
          application: 'orderhub-app'   # Имя приложения (для фильтрации)
          environment: 'production'      # Окружение (prod/staging/dev)
        
        # Если бы было несколько инстансов:
        # targets: 
        #   - 'orderhub-app-1:8081'
        #   - 'orderhub-app-2:8081'
        # Тогда метрики можно агрегировать: sum by(application) (rate(...))